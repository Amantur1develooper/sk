{% extends 'base.html' %}
{% load humanize %}
{% block page_title %}–í—ã–¥–µ–ª–µ–Ω–∏–µ —Å—Ä–µ–¥—Å—Ç–≤ –∏–∑ –û–±—â–∞–≥–∞{% endblock %}

{% block content %}
<link href="https://cdn.jsdelivr.net/npm/select2@4.1.0/dist/css/select2.min.css" rel="stylesheet" />
<script src="https://cdn.jsdelivr.net/npm/jquery@3.6.0/dist/jquery.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/select2@4.1.0/dist/js/select2.min.js"></script>

<div class="row justify-content-center">
  <div class="col-md-8">
    <div class="card">
      <div class="card-header">
        <h4>–í—ã–¥–µ–ª–µ–Ω–∏–µ —Å—Ä–µ–¥—Å—Ç–≤ –∏–∑ –û–±—â–∞–≥–∞</h4>
      </div>
      <div class="card-body">
        <div class="alert alert-info">
          –¢–µ–∫—É—â–∏–π –±–∞–ª–∞–Ω—Å –û–±—â–∞–≥–∞: <strong>{{ common_cash.balance }} —Å–æ–º</strong>
        </div>

        <!-- üîπ —Ñ–∏–ª—å—Ç—Ä –ø–æ –±–ª–æ–∫—É -->
        <form method="get" class="mb-3">
          <label for="block" class="form-label">–í—ã–±–µ—Ä–∏—Ç–µ –±–ª–æ–∫</label>
          <select name="block" id="block" class="form-select" onchange="this.form.submit()">
            <option value="">-- –≤—ã–±–µ—Ä–∏—Ç–µ –±–ª–æ–∫ --</option>
            {% for block in blocks %}
              <option value="{{ block.id }}" {% if block_id == block.id %}selected{% endif %}>
                {{ block.name }}
              </option>
            {% endfor %}
          </select>
        </form>

        <!-- üîπ —Ñ–æ—Ä–º–∞ –ø–æ—è–≤–ª—è–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ –≤—ã–±—Ä–∞–Ω –±–ª–æ–∫ -->
        {% if form %}
          <form method="post">
            {% csrf_token %}
            <div class="mb-3">
              <label for="{{ form.estimate_item.id_for_label }}" class="form-label">
                
                {{ form.estimate_item.label }}
              </label>
              {{ form.estimate_item }}
            </div>

            <div class="mb-3">
              <label for="{{ form.amount.id_for_label }}" class="form-label">{{ form.amount.label }}</label>
              {{ form.amount }}
            </div>

            <div class="mb-3">
              <label for="{{ form.description.id_for_label }}" class="form-label">{{ form.description.label }}</label>
              {{ form.description }}
            </div>

            <div class="d-grid gap-2">
              <button type="submit" class="btn btn-primary">–í—ã–¥–µ–ª–∏—Ç—å —Å—Ä–µ–¥—Å—Ç–≤–∞</button>
              <a href="{% url 'finances:allocations_list' %}" class="btn btn-secondary">–û—Ç–º–µ–Ω–∞</a>
            </div>
          </form>
        {% endif %}
      </div>
    </div>
  </div>
</div>

<script>
  $(document).ready(function() {
    $('#id_estimate_item').select2({
      width: '100%',
      placeholder: "–ù–∞—á–Ω–∏—Ç–µ –≤–≤–æ–¥–∏—Ç—å –ø–æ–∑–∏—Ü–∏—é —Å–º–µ—Ç—ã...",
      allowClear: true
    });
  });
</script>
{% endblock %}
